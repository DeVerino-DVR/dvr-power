---@diagnostic disable: undefined-global, trailing-space
local WandAnimations = {
    {
        label = "Balai - Bas",
        command = "broomdown",
        dict = "export@nib@broomstick_down",
        name = "nib@broomstick_down",
        description = "Animation balai vers le bas",
        category = "broomstick"
    },
    {
        label = "Balai - Haut Bas",
        command = "broomdownhg",
        dict = "export@nib@broomstick_down_hg",
        name = "nib@broomstick_down_hg",
        description = "Animation balai vers le bas (haute gravité)",
        category = "broomstick"
    },
    {
        label = "Balai - Avant",
        command = "broomfwd",
        dict = "export@nib@broomstick_fwd",
        name = "nib@broomstick_fwd",
        description = "Animation balai vers l'avant",
        category = "broomstick"
    },
    {
        label = "Balai - Avant Haut",
        command = "broomfwdhg",
        dict = "export@nib@broomstick_fwd_hg",
        name = "nib@broomstick_fwd_hg",
        description = "Animation balai vers l'avant (haute gravité)",
        category = "broomstick"
    },
    {
        label = "Balai - Avant Moyen",
        command = "broomfwdmed",
        dict = "export@nib@broomstick_fwd_med_hg",
        name = "nib@broomstick_fwd_med_hg",
        description = "Animation balai vers l'avant (moyen)",
        category = "broomstick"
    },
    {
        label = "Balai - Monter",
        command = "broomgetin",
        dict = "export@nib@broomstick_getin",
        name = "nib@broomstick_getin",
        description = "Animation monter sur le balai",
        category = "broomstick"
    },
    {
        label = "Balai - Chute",
        command = "broomfall",
        dict = "export@nib@broomstick_getin_falling_backs",
        name = "nib@broomstick_getin_falling_backs",
        description = "Animation chute de balai (arrière)",
        category = "broomstick"
    },
    {
        label = "Balai - Chute 2",
        command = "broomfall2",
        dict = "export@nib@broomstick_getin_falling_backs2",
        name = "nib@broomstick_getin_falling_backs2",
        description = "Animation chute de balai 2",
        category = "broomstick"
    },
    {
        label = "Balai - Montée",
        command = "broomup",
        dict = "export@nib@broomstick_getin_falling_upr",
        name = "nib@broomstick_getin_falling_upr",
        description = "Animation montée sur balai",
        category = "broomstick"
    },
    {
        label = "Balai - Décoller Air",
        command = "broomgetoffair",
        dict = "export@nib@broomstick_getoff_air",
        name = "nib@broomstick_getoff_air",
        description = "Animation descendre du balai en l'air",
        category = "broomstick"
    },
    {
        label = "Balai - Décoller Air (Main Gauche)",
        command = "broomgetoffairleft",
        dict = "export@nib@broomstick_getoff_air_left_hand",
        name = "nib@broomstick_getoff_air_left_hand",
        description = "Animation descendre du balai en l'air (main gauche)",
        category = "broomstick"
    },
    {
        label = "Balai - Décoller Sol",
        command = "broomgetoffground",
        dict = "export@nib@broomstick_getoff_ground",
        name = "nib@broomstick_getoff_ground",
        description = "Animation descendre du balai au sol",
        category = "broomstick"
    },
    {
        label = "Balai - Décoller Sol (Main Gauche)",
        command = "broomgetoffgroundleft",
        dict = "export@nib@broomstick_getoff_ground_left_hand",
        name = "nib@broomstick_getoff_ground_left_hand",
        description = "Animation descendre du balai au sol (main gauche)",
        category = "broomstick"
    },
    {
        label = "Balai - Idle",
        command = "broomidle",
        dict = "export@nib@broomstick_idle",
        name = "nib@broomstick_idle",
        description = "Animation balai idle",
        category = "broomstick"
    },
    {
        label = "Balai - Idle Sol",
        command = "broomidleground",
        dict = "export@nib@broomstick_idle_ground",
        name = "nib@broomstick_idle_ground",
        description = "Animation balai idle au sol",
        category = "broomstick"
    },
    {
        label = "Balai - Idle Démarrage",
        command = "broomidlestart",
        dict = "export@nib@broomstick_idle_start",
        name = "nib@broomstick_idle_start",
        description = "Animation balai idle démarrage",
        category = "broomstick"
    },
    {
        label = "Balai - Idle Tourner Gauche",
        command = "broomidleturnleft",
        dict = "export@nib@broomstick_idle_start_turn_left",
        name = "nib@broomstick_idle_start_turn_left",
        description = "Animation balai idle tourner à gauche",
        category = "broomstick"
    },
    {
        label = "Balai - Idle Tourner Droite",
        command = "broomidleturnright",
        dict = "export@nib@broomstick_idle_start_turn_right",
        name = "nib@broomstick_idle_start_turn_right",
        description = "Animation balai idle tourner à droite",
        category = "broomstick"
    },
    {
        label = "Balai - Idle Tourner Gauche",
        command = "broomidleturnleft2",
        dict = "export@nib@broomstick_idle_turn_left",
        name = "nib@broomstick_idle_turn_left",
        description = "Animation balai idle tourner gauche",
        category = "broomstick"
    },
    {
        label = "Balai - Idle Tourner Droite",
        command = "broomidleturnright2",
        dict = "export@nib@broomstick_idle_turn_right",
        name = "nib@broomstick_idle_turn_right",
        description = "Animation balai idle tourner droite",
        category = "broomstick"
    },
    {
        label = "Balai - Atterrir Bas",
        command = "broomlandlow",
        dict = "export@nib@broomstick_land_low",
        name = "nib@broomstick_land_low",
        description = "Animation atterrir bas avec balai",
        category = "broomstick"
    },
    {
        label = "Balai - Arrêt Haut",
        command = "broomstophg",
        dict = "export@nib@broomstick_stop_hg",
        name = "nib@broomstick_stop_hg",
        description = "Animation arrêt balai (haute gravité)",
        category = "broomstick"
    },
    {
        label = "Balai - Arrêt Lancer",
        command = "broomstoppedaimthrow",
        dict = "export@nib@broomstick_stopped_aim_throw_hg",
        name = "nib@broomstick_stopped_aim_throw_hg",
        description = "Animation arrêt balai viser et lancer",
        category = "broomstick"
    },
    {
        label = "Balai - Arrêt Haut",
        command = "broomstoppedhg",
        dict = "export@nib@broomstick_stopped_hg",
        name = "nib@broomstick_stopped_hg",
        description = "Animation arrêt balai (haute gravité)",
        category = "broomstick"
    },
    {
        label = "Balai - Arrêt Tirer",
        command = "broomstoppedshoot",
        dict = "export@nib@broomstick_stopped_shoot_hg",
        name = "nib@broomstick_stopped_shoot_hg",
        description = "Animation arrêt balai tirer",
        category = "broomstick"
    },
    {
        label = "Balai - Arrêt Lancer",
        command = "broomstoppedthrow",
        dict = "export@nib@broomstick_stopped_throw_hg",
        name = "nib@broomstick_stopped_throw_hg",
        description = "Animation arrêt balai lancer",
        category = "broomstick"
    },
    {
        label = "Balai - Arrêt Tourner Gauche",
        command = "broomstoppedturnleft",
        dict = "export@nib@broomstick_stopped_turn_left_hg",
        name = "nib@broomstick_stopped_turn_left_hg",
        description = "Animation arrêt balai tourner à gauche",
        category = "broomstick"
    },
    {
        label = "Balai - Arrêt Tourner Droite",
        command = "broomstoppedturnright",
        dict = "export@nib@broomstick_stopped_turn_right_hg",
        name = "nib@broomstick_stopped_turn_right_hg",
        description = "Animation arrêt balai tourner à droite",
        category = "broomstick"
    },
    {
        label = "Balai - Arrêt Deux Mains",
        command = "broomstoppedtwohands",
        dict = "export@nib@broomstick_stopped_two_hands_hg",
        name = "nib@broomstick_stopped_two_hands_hg",
        description = "Animation arrêt balai deux mains",
        category = "broomstick"
    },
    {
        label = "Balai - Invoquer Entrée",
        command = "broomsummonin",
        dict = "export@nib@broomstick_summon_in",
        name = "nib@broomstick_summon_in",
        description = "Animation invoquer balai (entrée)",
        category = "broomstick"
    },
    {
        label = "Balai - Tourner Gauche",
        command = "broomturnleft",
        dict = "export@nib@broomstick_turn_left",
        name = "nib@broomstick_turn_left",
        description = "Animation balai tourner à gauche",
        category = "broomstick"
    },
    {
        label = "Balai - Tourner Gauche Haut",
        command = "broomturnlefthg",
        dict = "export@nib@broomstick_turn_left_hg",
        name = "nib@broomstick_turn_left_hg",
        description = "Animation balai tourner à gauche (haute gravité)",
        category = "broomstick"
    },
    {
        label = "Balai - Tourner Gauche Moyen",
        command = "broomturnleftmed",
        dict = "export@nib@broomstick_turn_left_med_hg",
        name = "nib@broomstick_turn_left_med_hg",
        description = "Animation balai tourner à gauche (moyen)",
        category = "broomstick"
    },
    {
        label = "Balai - Tourner Droite",
        command = "broomturnright",
        dict = "export@nib@broomstick_turn_right",
        name = "nib@broomstick_turn_right",
        description = "Animation balai tourner à droite",
        category = "broomstick"
    },
    {
        label = "Balai - Tourner Droite Haut",
        command = "broomturnrighthg",
        dict = "export@nib@broomstick_turn_right_hg",
        name = "nib@broomstick_turn_right_hg",
        description = "Animation balai tourner à droite (haute gravité)",
        category = "broomstick"
    },
    {
        label = "Balai - Tourner Droite Moyen",
        command = "broomturnrightmed",
        dict = "export@nib@broomstick_turn_right_med_hg",
        name = "nib@broomstick_turn_right_med_hg",
        description = "Animation balai tourner à droite (moyen)",
        category = "broomstick"
    },
    {
        label = "Balai - Monter",
        command = "broomup2",
        dict = "export@nib@broomstick_up",
        name = "nib@broomstick_up",
        description = "Animation balai monter",
        category = "broomstick"
    },
    {
        label = "Balai - Monter Haut",
        command = "broomuphg",
        dict = "export@nib@broomstick_up_hg",
        name = "nib@broomstick_up_hg",
        description = "Animation balai monter (haute gravité)",
        category = "broomstick"
    },

    -- ========== JUMP/FALL ANIMATIONS ==========
    {
        label = "Chute - Atterrir",
        command = "jumpfallland",
        dict = "export@nib@jump_fall_land",
        name = "nib@jump_fall_land",
        description = "Animation chute et atterrissage",
        category = "misc"
    },

    -- ========== WIZARD ANIMATIONS ==========
    {
        label = "Sorcier - Ray",
        command = "avadakedravray",
        dict = "export@nib@avadakedrava_ray",
        name = "nib@avadakedrava_ray",
        description = "Animation rayon",
        category = "spells"
    },
    {
        label = "Sorcier - Ray 2",
        command = "avadakedravray2",
        dict = "export@nib@avadakedrava_ray2",
        name = "nib@avadakedrava_ray2",
        description = "Animation rayon 2",
        category = "spells"
    },
    {
        label = "Sorcier - Feu Tornade",
        command = "firetornado",
        dict = "export@nib@fire_tornado",
        name = "nib@fire_tornado",
        description = "Animation tornade de feu",
        category = "spells"
    },
    {
        label = "Sorcier - Rayon Magique Base",
        command = "magicraybasic",
        dict = "export@nib@magic_ray_basic",
        name = "nib@magic_ray_basic",
        description = "Animation rayon magique basique",
        category = "spells"
    },
    {
        label = "Sorcier - Protego Prop",
        command = "protegoprop",
        dict = "export@nib@protego_prop",
        name = "nib@protego_prop",
        description = "Animation Protego prop",
        category = "spells"
    },

    -- ========== WAND ATTACK ANIMATIONS ==========
    {
        label = "Attaque Baguette - Pose Base",
        command = "wandattackbase",
        dict = "export@nib@wizardsv_base_attack_pose",
        name = "nib@wizardsv_base_attack_pose",
        description = "Pose d'attaque de base avec baguette",
        category = "attacks"
    },
    {
        label = "Attaque Baguette - Pose Base 2",
        command = "wandattackbase2",
        dict = "export@nib@wizardsv_base_attack_pose2",
        name = "nib@wizardsv_base_attack_pose2",
        description = "Pose d'attaque de base 2 avec baguette",
        category = "attacks"
    },
    {
        label = "Attaque Baguette - Pose Base 2 Idle",
        command = "wandattackbase2idle",
        dict = "export@nib@wizardsv_base_attack_pose2_idle",
        name = "nib@wizardsv_base_attack_pose2_idle",
        description = "Pose d'attaque de base 2 idle",
        category = "attacks"
    },
    {
        label = "Attaque Baguette - Beatificus Victime",
        command = "beatificusvictim",
        dict = "export@nib@wizardsv_beastificus_victim1",
        name = "nib@wizardsv_beastificus_victim1",
        description = "Animation victime Beatificus",
        category = "attacks"
    },
    {
        label = "Attaque Baguette - Tenir Baguette",
        command = "holdwand",
        dict = "export@nib@wizardsv_hold_wand",
        name = "nib@wizardsv_hold_wand",
        description = "Animation tenir la baguette",
        category = "attacks"
    },
    {
        label = "Attaque Baguette - Sprint Magique",
        command = "magicsprint",
        dict = "export@nib@wizardsv_magicsprint",
        name = "nib@wizardsv_magicsprint",
        description = "Animation sprint magique",
        category = "attacks"
    },
    {
        label = "Attaque Baguette - Fin Sprint Magique",
        command = "magicsprintend",
        dict = "export@nib@wizardsv_magicsprint_end",
        name = "nib@wizardsv_magicsprint_end",
        description = "Animation fin de sprint magique",
        category = "attacks"
    },
    {
        label = "Attaque Baguette - Petrificus",
        command = "petrificus",
        dict = "export@nib@wizardsv_petrificus",
        name = "nib@wizardsv_petrificus",
        description = "Animation Petrificus",
        category = "attacks"
    },
    {
        label = "Attaque Baguette - Tourner Main",
        command = "spinhand",
        dict = "export@nib@wizardsv_spin_hand",
        name = "nib@wizardsv_spin_hand",
        description = "Animation tourner la main avec baguette",
        category = "attacks"
    },
    {
        label = "Attaque Baguette - Tourner Main 2",
        command = "spinhand2",
        dict = "export@nib@wizardsv_spin_hand2",
        name = "nib@wizardsv_spin_hand2",
        description = "Animation tourner la main 2",
        category = "attacks"
    },
    {
        label = "Attaque Baguette 1",
        command = "wandattack1",
        dict = "export@nib@wizardsv_wand_attack_1",
        name = "nib@wizardsv_wand_attack_1",
        description = "Animation attaque baguette 1",
        category = "attacks"
    },
    {
        label = "Attaque Baguette 1 - Balai",
        command = "wandattack1broom",
        dict = "export@nib@wizardsv_wand_attack_1_broom",
        name = "nib@wizardsv_wand_attack_1_broom",
        description = "Animation attaque baguette 1 sur balai",
        category = "attacks"
    },
    {
        label = "Attaque Baguette 1 - Course",
        command = "wandattack1run",
        dict = "export@nib@wizardsv_wand_attack_1_run",
        name = "nib@wizardsv_wand_attack_1_run",
        description = "Animation attaque baguette 1 en courant",
        category = "attacks"
    },
    {
        label = "Attaque Baguette 2",
        command = "wandattack2",
        dict = "export@nib@wizardsv_wand_attack_2",
        name = "nib@wizardsv_wand_attack_2",
        description = "Animation attaque baguette 2",
        category = "attacks"
    },
    {
        label = "Attaque Baguette 3",
        command = "wandattack3",
        dict = "export@nib@wizardsv_wand_attack_3",
        name = "nib@wizardsv_wand_attack_3",
        description = "Animation attaque baguette 3",
        category = "attacks"
    },
    {
        label = "Attaque Baguette 3.2",
        command = "wandattack32",
        dict = "export@nib@wizardsv_wand_attack_3_2",
        name = "nib@wizardsv_wand_attack_3_2",
        description = "Animation attaque baguette 3.2",
        category = "attacks"
    },
    {
        label = "Attaque Baguette 4",
        command = "wandattack4",
        dict = "export@nib@wizardsv_wand_attack_4",
        name = "nib@wizardsv_wand_attack_4",
        description = "Animation attaque baguette 4",
        category = "attacks"
    },
    {
        label = "Attaque Baguette 5",
        command = "wandattack5",
        dict = "export@nib@wizardsv_wand_attack_5",
        name = "nib@wizardsv_wand_attack_5",
        description = "Animation attaque baguette 5",
        category = "attacks"
    },
    {
        label = "Attaque Baguette - Éclair",
        command = "wandattacklightning",
        dict = "export@nib@wizardsv_wand_attack_lightning",
        name = "nib@wizardsv_wand_attack_lightning",
        description = "Animation attaque baguette éclair",
        category = "attacks"
    },
    {
        label = "Attaque Baguette - Éclair Balai",
        command = "wandattacklightningbroom",
        dict = "export@nib@wizardsv_wand_attack_lightning_broom",
        name = "nib@wizardsv_wand_attack_lightning_broom",
        description = "Animation attaque baguette éclair sur balai",
        category = "attacks"
    },
    {
        label = "Attaque Baguette - Smash",
        command = "wandattacksmash",
        dict = "export@nib@wizardsv_wand_attack_smash",
        name = "nib@wizardsv_wand_attack_smash",
        description = "Animation attaque baguette smash",
        category = "attacks"
    },
    {
        label = "Attaque Baguette - Smash Balai",
        command = "wandattacksmashbroom",
        dict = "export@nib@wizardsv_wand_attack_smash_broom",
        name = "nib@wizardsv_wand_attack_smash_broom",
        description = "Animation attaque baguette smash sur balai",
        category = "attacks"
    },
    {
        label = "Attaque Baguette B1",
        command = "wandattackb1",
        dict = "export@nib@wizardsv_wand_attack_b1",
        name = "nib@wizardsv_wand_attack_b1",
        description = "Animation attaque baguette B1",
        category = "attacks"
    },
    {
        label = "Attaque Baguette B2",
        command = "wandattackb2",
        dict = "export@nib@wizardsv_wand_attack_b2",
        name = "nib@wizardsv_wand_attack_b2",
        description = "Animation attaque baguette B2",
        category = "attacks"
    },
    {
        label = "Attaque Baguette B2 - Balai",
        command = "wandattackb2broom",
        dict = "export@nib@wizardsv_wand_attack_b2_broom",
        name = "nib@wizardsv_wand_attack_b2_broom",
        description = "Animation attaque baguette B2 sur balai",
        category = "attacks"
    },
    {
        label = "Attaque Baguette B2 - Course",
        command = "wandattackb2run",
        dict = "export@nib@wizardsv_wand_attack_b2_run",
        name = "nib@wizardsv_wand_attack_b2_run",
        description = "Animation attaque baguette B2 en courant",
        category = "attacks"
    },
    {
        label = "Attaque Baguette B3",
        command = "wandattackb3",
        dict = "export@nib@wizardsv_wand_attack_b3",
        name = "nib@wizardsv_wand_attack_b3",
        description = "Animation attaque baguette B3",
        category = "attacks"
    },
    {
        label = "Attaque Baguette B3 - Balai",
        command = "wandattackb3broom",
        dict = "export@nib@wizardsv_wand_attack_b3_broom",
        name = "nib@wizardsv_wand_attack_b3_broom",
        description = "Animation attaque baguette B3 sur balai",
        category = "attacks"
    },
    {
        label = "Attaque Baguette B3 - Course",
        command = "wandattackb3run",
        dict = "export@nib@wizardsv_wand_attack_b3_run",
        name = "nib@wizardsv_wand_attack_b3_run",
        description = "Animation attaque baguette B3 en courant",
        category = "attacks"
    },
    {
        label = "Attaque Baguette B4",
        command = "wandattackb4",
        dict = "export@nib@wizardsv_wand_attack_b4",
        name = "nib@wizardsv_wand_attack_b4",
        description = "Animation attaque baguette B4",
        category = "attacks"
    },
    {
        label = "Attaque Baguette B4 - Balai",
        command = "wandattackb4broom",
        dict = "export@nib@wizardsv_wand_attack_b4_broom",
        name = "nib@wizardsv_wand_attack_b4_broom",
        description = "Animation attaque baguette B4 sur balai",
        category = "attacks"
    },
    {
        label = "Attaque Baguette B5",
        command = "wandattackb5",
        dict = "export@nib@wizardsv_wand_attack_b5",
        name = "nib@wizardsv_wand_attack_b5",
        description = "Animation attaque baguette B5",
        category = "attacks"
    },
}

local SPEED_MIN, SPEED_MAX, SPEED_STEP = 0.5, 20.0, 0.5
local SPEED_VALUES = {}
for s = SPEED_MIN, SPEED_MAX, SPEED_STEP do
    SPEED_VALUES[#SPEED_VALUES + 1] = string.format('x%.2f', s)
end

local function ClampSpeed(value)
    local v = tonumber(value) or 1.0
    if v < SPEED_MIN then v = SPEED_MIN end
    if v > SPEED_MAX then v = SPEED_MAX end
    return v
end

local function SpeedIndexFromValue(value)
    local v = ClampSpeed(value)
    return math.floor(((v - SPEED_MIN) / SPEED_STEP) + 1)
end

local function SpeedValueFromIndex(index)
    local idx = tonumber(index) or 1
    if idx < 1 then idx = 1 end
    if idx > #SPEED_VALUES then idx = #SPEED_VALUES end
    return SPEED_MIN + (idx - 1) * SPEED_STEP
end

local function PlayWandAnimation(animData)
    local playerPed = PlayerPedId()
    local dictName = animData.dict
    local animName = animData.name
    local speed = ClampSpeed(animData.speedMultiplier or animData.speed or 1.0)
    
    RequestAnimDict(dictName)
    local timeout = 0
    while not HasAnimDictLoaded(dictName) and timeout < 5000 do
        Wait(10)
        timeout = timeout + 10
    end
    
    if not HasAnimDictLoaded(dictName) then
        lib.notify({
            title = 'Animation introuvable',
            description = ('Dict "%s" manquant, aucune anim jouée.'):format(dictName),
            type = 'error'
        })
        return
    end

    TaskPlayAnim(playerPed, dictName, animName, 8.0, -8.0, -1, 0, 0, false, false, false)
    SetEntityAnimSpeed(playerPed, dictName, animName, speed)
    SetTimeout(50, function()
        SetEntityAnimSpeed(playerPed, dictName, animName, speed)
    end)
end

local function StopCurrentAnimation()
    local playerPed = PlayerPedId()
    ClearPedTasks(playerPed)
end

local function BuildCategoryMenu(category, categoryName)
    local options = {}
    
    for i, anim in ipairs(WandAnimations) do
        if anim.category == category then
            table.insert(options, {
                label = anim.label,
                description = anim.description,
                icon = 'wand-magic-sparkles',
                args = { animIndex = i },
                values = SPEED_VALUES,
                defaultIndex = SpeedIndexFromValue(anim.speedMultiplier or anim.speed or 1.0),
                close = false
            })
        end
    end
    
    return options
end

lib.registerMenu({
    id = 'wand_animations_broomstick',
    title = 'Animations Balai',
    position = 'top-right',
    onClose = function(keyPressed)
        lib.showMenu('wand_animations_main')
    end,
    options = BuildCategoryMenu('broomstick', 'Balai')
}, function(selected, scrollIndex, args)
    if args and args.animIndex then
        local anim = WandAnimations[args.animIndex]
        if anim then
            if scrollIndex and scrollIndex > 0 then
                anim.speedMultiplier = SpeedValueFromIndex(scrollIndex)
            end
            PlayWandAnimation(anim)
        end
    end
end)

lib.registerMenu({
    id = 'wand_animations_spells',
    title = 'Animations Sorts',
    position = 'top-right',
    onClose = function(keyPressed)
        lib.showMenu('wand_animations_main')
    end,
    options = BuildCategoryMenu('spells', 'Sorts')
}, function(selected, scrollIndex, args)
    if args and args.animIndex then
        local anim = WandAnimations[args.animIndex]
        if anim then
            if scrollIndex and scrollIndex > 0 then
                anim.speedMultiplier = SpeedValueFromIndex(scrollIndex)
            end
            PlayWandAnimation(anim)
        end
    end
end)

lib.registerMenu({
    id = 'wand_animations_attacks',
    title = 'Animations Attaques',
    position = 'top-right',
    onClose = function(keyPressed)
        lib.showMenu('wand_animations_main')
    end,
    options = BuildCategoryMenu('attacks', 'Attaques')
}, function(selected, scrollIndex, args)
    if args and args.animIndex then
        local anim = WandAnimations[args.animIndex]
        if anim then
            if scrollIndex and scrollIndex > 0 then
                anim.speedMultiplier = SpeedValueFromIndex(scrollIndex)
            end
            PlayWandAnimation(anim)
        end
    end
end)

lib.registerMenu({
    id = 'wand_animations_misc',
    title = 'Animations Divers',
    position = 'top-right',
    onClose = function(keyPressed)
        lib.showMenu('wand_animations_main')
    end,
    options = BuildCategoryMenu('misc', 'Divers')
}, function(selected, scrollIndex, args)
    if args and args.animIndex then
        local anim = WandAnimations[args.animIndex]
        if anim then
            if scrollIndex and scrollIndex > 0 then
                anim.speedMultiplier = SpeedValueFromIndex(scrollIndex)
            end
            PlayWandAnimation(anim)
        end
    end
end)

lib.registerMenu({
    id = 'wand_animations_main',
    title = 'Animations Baguette',
    position = 'top-right',
    onClose = function(keyPressed)
        StopCurrentAnimation()
    end,
    options = {
        {
            label = 'Animations Balai',
            description = '37 animations de vol sur balai',
            icon = 'broom',
            args = { submenu = 'broomstick' }
        },
        {
            label = 'Animations Sorts',
            description = '5 animations de sorts magiques',
            icon = 'bolt',
            args = { submenu = 'spells' }
        },
        {
            label = 'Animations Attaques',
            description = '32 animations d\'attaques à la baguette',
            icon = 'hand-sparkles',
            args = { submenu = 'attacks' }
        },
        {
            label = 'Animations Divers',
            description = 'Autres animations',
            icon = 'box',
            args = { submenu = 'misc' }
        },
        {
            label = 'Arrêter Animation',
            description = 'Arrêter l\'animation en cours',
            icon = 'stop',
            args = { action = 'stop' }
        }
    }
}, function(selected, scrollIndex, args)
    if args.submenu then
        lib.showMenu('wand_animations_' .. args.submenu)
    elseif args.action == 'stop' then
        StopCurrentAnimation()
    end
end)

RegisterCommand('wandtest', function()
    lib.showMenu('wand_animations_main')
end, false)

RegisterCommand('testneeds', function(_, args)
    local value = tonumber(args[1]) or 0
    
    TriggerEvent('esx_status:set', 'hunger', value * 10000)
    TriggerEvent('esx_status:set', 'thirst', value * 10000)
    
    if HUD and HUD.UpdateStats then
        HUD.UpdateStats(nil, value, value)
    end
    
    lib.notify({
        title = 'Test Needs',
        description = ('Faim et soif mis à %d%%'):format(value),
        type = 'info'
    })
end, false)

return WandAnimations
